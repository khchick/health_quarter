<script type='text/javascript' src="/js/searchcal.js"></script>


<div class="container">
    <header>
        <h1>
            <a href="/home">Health Quarter</a>
        </h1>
        <a href="/delivery">Delivery</a>
        <a href="/favouriteRest">My Favourites</a>
        Recipe Finder
        <a href="/logout">LOGOUT</a>
    </header>

    <h2>Recipe(s) found: </h2>
    <table class="table" id="recipe_table">
        <tr>
            <th>Recipe Name:</th>
            <th>Total Calories:</th>
            <th>Image:</th>
            <th>Learn more button:</th>
            <th>Favourite Recipe</th>
        </tr>
    </table>

</div>

<script src='https://code.jquery.com/jquery-2.2.4.min.js'></script>
<scripr src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js'>
    </script>
    <script type='text/javascript'>

        // make data useable
        let recipes = {{{ data }}};

        $.each(recipes, function (key, value) {
            recipes += '<tr>';
            recipes += '<td>' + value.title + '</td>';
            recipes += '<td>' + value.calories + '</td>';
            recipes += '<td><img src=' + value.image + '></td>';
            recipes += '<td><a href="https://spoonacular.com/' + value.title + '-' + value.id + '">Learn More</a></td>';
            recipes += '<td><button class="saveRecipe" type="button" data-id="' + value.title + '-' + value.id + '">Favourite Recipe</button></td>';
            recipes += '</tr>';
        });
        $('#recipe_table').append(recipes);


        $('.saveRecipe').on('click', (e) => {
            console.log('clicked.')
            let recURL = $(e.currentTarget).data('id')
            toggleFav(recURL);
            console.log(recURL);
            axios({
                method: 'post',
                url: '/api/fav/recipes',
                data: {
                    recURL: `${recURL}`
                }
            }).then(() => {
                $(e.currentTarget).html("isFav");
            })
            function toggleFav(recURL) {
                if ($(e.currentTarget).html() === "isFav") {
                    axios({
                        method: 'delete',
                        url: '/api/fav/recipes',
                        data: {
                            recURL: `${recURL}`
                        }
                    }).then(() => { 
                        $(e.currentTarget).html("notFav");
                    })
                }
                if ($(e.currentTarget).html() === "notFav") {
                    axios({
                        method: 'post',
                        url: '/api/fav/recipes',
                        data: {
                            recURL: `${recURL}`
                        }
                    }).then(() => {
                        $(e.currentTarget).html("isFav");
                    })
                }
            }
        });

    </script>