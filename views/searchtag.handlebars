<div class="container">
    <header>
        <h1><a href="/home">Health Quarter</a></h1>
        <a href="/delivery">Delivery</a>
        <a href="/favouriteRest">My Favourites</a>
        Recipe Finder
        <a href="/logout">LOGOUT</a>
    </header>

<h2>Recipe(s) found: </h2>
<table class="table" id="recipe_table">
    <tr>
        <th>Recipe Name:</th>
        <th>Total Servings:</th>
        <th>Image:</th>
        <th>Instructions:</th>
        <th>Cooking Time:</th>
        <th>Learn more button:</th>
        </th>Favourite Recipe </th>
    </tr>
</table>

<script src='https://code.jquery.com/jquery-2.2.4.min.js'></script>
<scripr src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js'>
    </script>
    <script type='text/javascript'>

        // make data useable
        let recipes = {{{ data }}};

        $.each(recipes.recipes, function (key, value) {
            recipes += '<tr>';
            recipes += '<td>' + value.title + '</td>';
            recipes += '<td>' + value.servings + '</td>';
            recipes += '<td><img src=' + value.image + '></td>';
            recipes += '<td>' + value.instructions + '</td>';
            recipes += '<td>' + value.readyInMinutes + '</td';
            recipes += '<td><a href=' + value.spoonacularSourceUrl + '>Learn More</a></td>';
            recipes += '<td><button class="saveRecipe" type="button" data-id="https://spoonacular.com/' + value.title + '-' + value.id + '">Favourite Recipe</button></td>';
            recipes += '</tr>';
        });
        $('#recipe_table').append(recipes);


  $('.saveRecipe').on('click', (e) => {
            console.log('clicked.')
            let recURL = $(e.currentTarget).data('id')
            toggleFav(recURL);
//wont get the results, they don't exist/ can't find location?
            $.get(`/api/fav/rec/${recURL}`).then(res => {
                console.log(res);
                let status = JSON.parse(recURL);
                if (status === true) {
                    $('.saveRecipe').html("isFav");
                } else {
                    $('.saveRecipe').html("notFav");
                }
            });

            function toggleFav(recURL) {
                if ($('.saveRecipe').html() === "isFav") {
                    axios.delete(`/api/fav/rec/${recURL}`).then(() => {
                        $('.saveRecipe').html("notFav");
                    })
                }
                if ($('.saveRecipe').html() === "notFav") {
                    axios.post(`/api/fav/rec/${recURL}`).then(() => {
                        $('.saveRecipe').html("isFav");
                    })
                }
            }
        })
    </script>
